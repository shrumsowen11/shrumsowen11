<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Customer Beneficiaries</title>
  <meta charset="utf-8">
  <!-- ******************************************************************************************** -->
  <!-- ******************************************************************************************** -->
  <!-- ****************************** THIS ORDER IS IMPORTANT ************************************* -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
  
  <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js"></script>
  
   
  <script type="text/javascript">
  $(document).ready(function() {
	    $('#beneficiaryList').DataTable();
	} );
  </script>
  
  <style>
.ffooter {
  position: fixed;
  left: 0;
  bottom: 0;
  width: 100%;
  background-color: red;
  color: white;
  text-align: center;
  height: 30px;
  background-color:#e9ffe7;
}
</style>

<script type="text/javascript">


function editPayee(payeeName,ac,nickName,JavaId){
	 $("#payeeName").val(payeeName);
	 $("#payeeAccountNo").val(ac);
	 $("#payeeNickName").val(nickName);
	 $("#id").val(JavaId);
	 $('#editPayeeModal').modal('show');
}

function editPayeeJQuery(payeeName,ac,nickName,JavaId){
	
	var jsonObj={payeeName:payeeName, payeeAccountNo:ac, payeeNickName:nickName, id:JavaId};
	var jsonString= JSON.stringify(jsonObj); 

	 const options = {
			 method: 'POST',
			 body: jsonString,
			 headers: {
				 'Content-Type':'application/json',
				 'Accept' :'application/json'
			 }
		   }; 
	 
	  
	  var promise=fetch('/v3/customers/editPayee',options);
		 promise.then(res => res.json()).then(function(data){   
			 ///this curly bracket is required becuase of the multiple statements being used inside this
						if(data.code == 200){
							alert("sucess");
							$("#row_"+JavaId).hide();
							$("#message").html(data.message);
						}else{
							alert("fail");
							$("#error").html("Some error occurred. Try Again.");
						}
					});

	 $('#editPayeeModal').modal('show');
}


function deletePayee(JavaId) {
	//deleting the data using the AJAX call
	
	
	//var obj = {};
	
	
		var jsonObj={id:JavaId};  
		//id		==> must match with the id in the VO present in RestAPI
		//JavaId 	==> must match the id passed as the argument in the function
		var jsonString= JSON.stringify(jsonObj); 
		 
		  const options = {
				 method: 'DELETE',
				 body: jsonString,
				 headers: {
					 'Content-Type':'application/json',
					 'Accept' :'application/json'
				 }
			   }; 
		 
		  
		  var promise=fetch('/v3/customers/deletePayee',options);
			 promise.then(res => res.json()).then(function(data){   ///this curly bracket is required becuase of the multiple statements being used inside this
							if(data.code == 200){
								alert("sucess");
								$("#row_"+JavaId).hide();
								$("#message").html(data.message);
							}else{
								alert("fail");
								$("#error").html("Some error occurred. Try Again.");
							}
						});
	
	
	
	
	//when directly deleting the datas from the DataBase itself, if you want to only hide the data in the client side, use upper method
	/* window.location.href="http://localhost:999/customers/deletePayee?payeeAccountNo="+ac; */
}

</script>

</head>
<body>
<div th:insert="customer/header"></div> 
<div class="container"> 
 <div th:insert="customer/nav"></div> 
  <h2>Your Beneficiaries
  </h2>
  <a th:href="@{/customer/addBeneficiary}"> 
  <button type="button" class="btn btn-primary">Add Beneficiary</button>
</a>

<br />
   <span  th:utext="${error}" style="color: red;font-size: 18px;"></span>
   <span  th:id ="${message}" th:utext="${message}" style="color: blue;font-size: 18px;"></span>
   
   
   <hr/>
   <!-- ************************** UNLESS PART **************************** -->
  <!--  <div style="width: 100%" th:if = "${payeeList == null}">
  You do not have any Beneficiary added. Add Beneficiary first. 
  </div> -->
   
   
  <div style="width: 100%" th:if = "${payeeList != null}">
  <!-- 
  If you want using variable's field it's worth checking if this field exists as well

<div th:if="${variable != null && variable.name != null}" th:text="${variable.name}">
   I wonder, if variable.name exists...
</div>
   -->
    <table id="beneficiaryList" class="table table-striped table-bordered" style="width:100%">
  <thead>
  <tr>
  <th> Name </th>
  <th> Account Number </th>
  <th> Nickname </th>
  <th> Action </th>
  
  </tr>
  </thead>
  
  <tbody>
  <tr  th:each="beneficiary : ${payeeList}" th:id = "'row_'+${beneficiary.id}">
  	<td th:text="${beneficiary.payeeName}"/>
  	<td th:text="${beneficiary.payeeAccountNo}"/>
  	<td th:text="${beneficiary.payeeNickName}"/>
  	
  	<td>
    <a th:onclick="|editPayee('${beneficiary.payeeName}','${beneficiary.payeeAccountNo}','${beneficiary.payeeNickName}',${beneficiary.id})|" 
    style="cursor: pointer;"> 
  	<button type="button"  class="btn btn-warning">Edit</button>
  	</a>
  	
  	
  	 
  	  <a th:onclick="|deletePayee('${beneficiary.id}')|" style="cursor: pointer;">
     <button type="button" class="btn btn-danger"> Delete</button>
     </a>
     
     
   	</td>
  	
  </tr>
  </tbody>
  </table>
  </div>
  
  
</div>
<footer  class="ffooter">
</footer>




<!-- The Modal -->
  <div class="modal" id="editPayeeModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <!-- Modal Header -->
        
      <form action="#" method="post"  th:action="@{/customer/editPayee}" th:object="${payeeInfoVO}">
        <div class="modal-header">
          <h4 class="modal-title">Edit Beneficiary Information</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        
        <!-- Modal body -->
        <div class="modal-body">
        	<input type="hidden"  name="id" id="id" class="form-control" />
        
            Beneficiary Name <!-- the function takes ID  -->
            <input type="text" name="payeeName" id="payeeName"  class="form-control" required>
            <!-- th:field="*{payeeInfoVO.payeeName}" -->
        	Beneficiary Account Number
            <input type="text" name="payeeAccountNo" id="payeeAccountNo"  class="form-control" readonly>
        	<!-- th:field="*{payeeInfoVO.payeeAccountNo}" -->
        	Beneficiary Nickname
            <input type="text" name="payeeNickName" id="payeeNickName" class="form-control" required>
        	<!--th:field="*{payeeInfoVO.payeeNickName}"   -->
        	Remarks
            <input type="text" name="remarks" class="form-control"  required placeholder = "Simple Beneficiary description">
        	<!-- th:field="*{payeeInfoVO.remarks}" -->
        </div>
        
        <!-- Modal footer -->
        <div class="modal-footer">
        
    <a onclick="editPayeeJQuery('${beneficiary.payeeName}','${beneficiary.payeeAccountNo}','${beneficiary.payeeNickName}',${beneficiary.id})" 
    style="cursor: pointer;"> 
  	<button type="button"  class="btn btn-success">Update Using JS/JQ</button>
  	</a>
          <button type="submit" class="btn btn-danger">Update Simple/Direct</button>
        </div>
        </form>
      </div>
    </div>
  </div>



</body>
</html>
